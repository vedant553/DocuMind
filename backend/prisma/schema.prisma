generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")       // Pooled connection
  directUrl = env("DIRECT_DATABASE_URL") // Direct connection
}

// User model
model User {
  id        Int       @id @default(autoincrement())
  email     String    @unique
  name      String?
  password  String    // Will hash this later
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  
  projects  Project[] // One user has many projects
}

// Project model (user workspace)
model Project {
  id          Int        @id @default(autoincrement())
  name        String
  description String?
  userId      Int
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  
  user        User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  documents   Document[] // One project has many documents
}

// Document model (uploaded files)
model Document {
  id        Int       @id @default(autoincrement())
  name      String
  fileUrl   String    // Cloudinary URL
  fileType  String    // pdf, txt, md
  fileSize  Int       // in bytes
  status    String    @default("processing") // processing, completed, failed
  projectId Int
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  
  project   Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
  chunks    DocumentChunk[] // One document has many chunks
}

// DocumentChunk model (for RAG)
model DocumentChunk {
  id         Int      @id @default(autoincrement())
  content    String   @db.Text // The actual text chunk
  embedding  String?  // We'll store as JSON string for now, optimize later
  chunkIndex Int      // Order of chunks in document
  documentId Int
  createdAt  DateTime @default(now())
  
  document   Document @relation(fields: [documentId], references: [id], onDelete: Cascade)
  
  @@index([documentId]) // Speed up queries by documentId
}
